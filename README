ORTHOGRAPH: Orthology prediction using a Graph-based, Reciprocal Approach with
Hidden Markov models

SYSTEM REQUIREMENTS
===================

Orthograph requires the following software packages to be installed on the
system. The whole package was tested and works with these versions, and newer
versions should be no problem. Downwards compatibility (i.e., older versions)
has not been tested. Should be fine, too, but be wary with MAFFT, its developers
change or drop features frequently across versions.

Package      Version Download from
-------------------------------------------------------------------------------
MySQL        5.1     http://www.mysql.com
MAFFT        6.951   http://mafft.cbrc.jp/alignment/software/
HMMer        3.0     http://hmmer.janelia.org
NCBI BLAST+  2.2.25+ ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/LATEST/
Exonerate    2.2.0   http://www.ebi.ac.uk/~guy/exonerate/ 

Make sure you get the correct versions for your operating system (most packages
are provided as 32 bit and 64 bit versions).

Don't worry about your Perl version if you run a reasonably recent Linux or UNIX
system, such as Mac OS X, but see [1] and [2] if you are trying to install
the required packages on a Windows system under Cygwin (or natively, for that
matter). You might run into problems getting the MySQL driver, HMMer3 and
Exonerate to work. Really, don't use Windows. 

If you get an error like "Can't locate Some/Module.pm in @INC", you need to
update your Perl installation; see REQUIRED PERL MODULES for more information.

DATA REQUIREMENTS
=================

Orthograph is an orthology prediction pipeline. 


QUICKSTART
==========

For a fast start into analysis using Orthograph, follow these steps. They
assume that all required software packages are installed and work. 

0. These conventions are used throughout this documentation:

  $ some_command

This means you should enter some_command at the shell prompt. The '$' sigil is
not part of the command.

  mysql> SOME STATEMENT;

This means you should enter SOME STATEMENT at the MySQL prompt. The 'mysql>' is
not part of the statement, but the semicolon is.

1. Set up the MySQL database. 

Skip this step if you already have a MySQL account and a database (and know
what your credentials are).

There must exist a database for your usage and a database user must have the
usual permissions on it. If you are the administrator of your local machine and
installed MySQL yourself, you have those privileges. However, you should never
do ordinary work as root (the administrator), so let's create a working user.
Login to MySQL as root:

  $ mysql -u root -p
  Enter password:

Enter the MySQL administrator password. You will be greeted by MySQL and then
given a new prompt. Issue the following statement:

  mysql> CREATE USER 'USERNAME'@'localhost' IDENTIFIED BY 'PASSWORD';

Substitute USERNAME and PASSWORD with your username and password of choice. The
single quotes are important. Next, you will create a database and grant the
working user the necessary permissions on it:

  mysql> CREATE DATABASE orthograph;
  mysql> GRANT ALL ON orthograph.* TO 'USERNAME'@'localhost';

You may use a different database name, of course. Make a note of your new user
name, the password and the database name. You will need it later.

2. Create a config file. 

Copy the supplied config file orthograph.conf.example to orthograph.conf and
edit it. The file is commented to help you start off. Most options are
self-explanatory. 

For now, it is sufficient to supply the MySQL settings (server, database,
username, password). 

Note: The config file is read by all three Orthograph tools. Especially the
mandatory part of the file is important as it contains critical settings for
the database interaction. Without these settings none of the programs will
work.

3. Create the tables. Make the orthograph_manager script executable and use it:

  $ chmod +x orthograph-manager
  $ ./orthograph-manager -create

The -create switch tells the script to setup the database structure for
Orthograph.  It will create a number of tables, all of which start with the
prefix 'orthograph_'. 

4. Upload your ortholog set into the database:

  $ ./orthograph-manager FASTAFILE

You will be asked for information about the ortholog set you are loading. If
you made a mistake during input of the information, you may cancel the process
at any time using Ctrl+C. I'm sorry if you mistyped the last taxon name and have
to start over :)

The fasta file must have an OrthoDB-style header format as in the following
example:

	>AAEGY:m0cp83 AAEL005334 EOG5000ZK AAEL005334-PA [foo bar baz]

That is, there must exist five space-separated fields, the last one of which may
contain whitespace as well. This is output by OrthoDB [3] by default, so you
don't have to worry about that if you downloaded your ortholog set from OrthoDB.
However, dependent on your OrthoDB query, you may need to filter your file so
that it contains only the taxa you want in the ortholog set. A filter script is
provided upon request.  If you didn't get your data from OrthoDB, read `perldoc
orthograph_manager` for further information. Make a note of your ortholog set
name. You will need it later.

5. Load proteome sequences into the database :

  $ ./orthograph-manager -load_ogs_peptide FASTAFILE

You need to load data for every taxon separately (this may change in the
future), and you should load data for as many taxa in the orthologs file as
possible. You will be asked for information about the file you are loading.
These sequences are used for the reciprocal BLAST databases. If you don't load
any peptide data, your analysis will be flawed. 

Some of the protein IDs must correspond to the second header field in the
OrthoDB file. This is important, as these are regarded as part of the ortholog
groups. Repeat this step for as many taxa in your ortholog set as you have
peptide sequences for.

If you made a mistake during input of the information, you may cancel the
process at any time using Ctrl+C. 

6. Optional: Load nucleotide sequence data into the database:

  $ ./orthograph-manager -load_ogs_nucleotide FASTAFILE

The nucleotide sequences are expected to be the coding sequences for the
peptide sequences you loaded earlier. The headers have to correspond EXACTLY,
or they cannot be correlated and nucleotide output is not possible. For
example, these two headers are not equal, even though they look similar:

  >AAEL1307285-PA Q0C738 Bystin IPR007955
  >AAEL1307285-RA Q0C738 Bystin IPR007955

Make sure the nucleotide sequences can be correlated to the proteome sequences
by giving identical names to corresponding sequences.

7. Create the required database structure for Orthograph. Make
orthograph-analyzer executable and run it with the -prepare option:

  $ chmod +x orthograph-analyzer
  $ ./orthograph-analyzer -prepare

8. Complete your config file if you didn't fill out everything before.

Supply the rest of the mandatory settings and consider changing some optional
ones that will affect the searches.

9. Start Orthograph! 

  $ ./orthograph-analyzer

10. Get some coffee, sit back and watch (or do something else).

Orthograph generates the profile hidden Markov models (pHMMs) for your ortholog
set, if they don't exist. This may take a long time depending on the size of
your set, but rest assured, once the pHMMs exist, subsequent analyses will be
faster by that amount of time.

After that, your input file is searched using all pHMMs. Candidate orthologs
are verified with a reciprocal search against the BLAST database of all
proteomes in your ortholog set. The results are cached in the database.
Orthograph-reporter can afterwards be used to establish ortholog relationships
and report about the results in various ways.

The output directory contains four subdirectories:

a) hmmsearch. This contains all the HMMsearch output tables.

b) blastp. This contains all the BLASTP output tables.

c) aa. This contains the actual result of your analysis. The hit sequences are
output along with the core-ortholog sequences from your ortholog set, grouped
by ortholog groups.

d) log. This contains log files, such as the entire Orthograph output and the
report after running orthograph-reporter.

12. ???

13. Profit!


COMMON PROBLEMS
===============
"No sequences found. Something went wrong. Check your input file. Exiting." 

Really, check your input file. Is it empty? Is it a valid fasta file? If it
looks ok, try deleting the translated version. 

++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+++ The rest of this document is outdated! So is `perldoc orthograph`. +++
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

SETUP
=====

The MySQL database must be setup prior to running Orthograph and must contain
both orthology information and peptide data. The script orthograph_manager is
provided for your convenience. Refer to its perldoc documentation for further
instructions.

INVOCATION
==========

Orthograph allows parsing a config file, which by default is named
'orthograph.conf'.  Available options can be obtained using 'perldoc
orthograph'. Many options can be set or overridden on the command line. For
those switches, also see `perldoc orthograph`.

MySQL PERFORMANCE
=================

Orthograph makes extensive use of MySQL query caching. For optimal performance,
make sure that query caching is enabled in your MySQL instance. Also, if you
plan to run multiple orthograph instances on the same database, you should
definitely use table files instead of database files (innodb_file_per_table)
and increase the lock wait timeout (innodb_lock_wait_timeout) to between 200
and 600 to make sure that long queries (which may occur) do not block other
orthograph processes.

REQUIRED PERL MODULES
=====================
Orthograph uses only modules that are present in any standard Perl distribution. 
If you get an error like "Can't locate Some/Thing.pm in @INC" it means that
Perl can't find one of the required modules. Update your Perl installation if
this is the case and make sure it contains these modules:

Archive::Tar
Benchmark 
Carp
Config
DBD::mysql
DBI
Data::Dumper
Digest::SHA
File::Basename
File::Path
File::Temp
FindBin
Getopt::Long
IO::Dir
IO::File
List::Util 
Time::HiRes

Part of my Diploma thesis at the ZFMK/zmb, Bonn, Germany 
(c) 2011-2012 Malte Petersen <mptrsen@uni-bonn.de>

[1] http://cpansearch.perl.org/src/JWIED/DBD-mysql-2.1028/INSTALL.html#special systems
[2] http://forums.mysql.com/read.php?51,389833,389833
[3] http://cegg.unige.ch/orthodb5
